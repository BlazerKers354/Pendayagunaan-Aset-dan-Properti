  {% extends "layout.html" %}

{% block title %}Dashboard Pengguna - Pendayagunaan Aset{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header Dashboard -->
    <div class="dashboard-header">            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="dashboard-title">
                            <i class="fas fa-home me-3"></i>
                            Data Properti
                        </h1>
                        <p class="dashboard-subtitle">Temukan properti yang tepat untuk kebutuhan Anda</p>
                    </div>
                    <div class="col-md-4 text-end">
                        <div class="user-info">
                            <span class="user-welcome">Halo, {{ session.get('user_name', 'Pengguna') }}!</span>
                            <a href="{{ url_for('main.logout') }}" class="btn btn-outline-danger btn-sm ms-2">
                                <i class="fas fa-sign-out-alt me-1"></i>Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>
    </div>

    <!-- Main Content -->
    <div class="dashboard-content">
        <div class="container-fluid">
            <!-- Asset Type Selection -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="asset-selection-card">
                        <div class="card-header">
                            <h3><i class="fas fa-building me-2"></i>Pilih Jenis Aset</h3>
                            <p>Silakan pilih jenis aset yang ingin Anda lihat</p>
                        </div>
                        <div class="card-body">
                            <div class="asset-dropdown-container">
                                <select id="assetTypeSelect" class="form-select asset-select">
                                    <option value="">-- Pilih Jenis Aset --</option>
                                    <option value="tanah">üåç Tanah</option>
                                    <option value="tanah_bangunan">üè¢ Tanah & Bangunan</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter section -->
            <div id="filterSection" style="display: none;">
                <div class="row justify-content-center mb-5">
                    <div class="col-lg-10">
                        <div class="card shadow-sm border-0">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="fas fa-filter me-2"></i>Filter Pencarian</h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label for="assetConditionFilter" class="form-label">Kondisi Properti</label>
                                        <select class="form-select" id="assetConditionFilter">
                                            <option value="">Semua Kondisi</option>
                                            <option value="baru">Baru</option>
                                            <option value="bagus">Bagus</option>
                                            <option value="sudah renovasi">Sudah Renovasi</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="locationFilter" class="form-label">Kecamatan</label>
                                        <select class="form-select" id="locationFilter">
                                            <option value="">Semua Kecamatan</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3" id="bedroomFilterContainer">
                                        <label for="bedroomFilter" class="form-label">Kamar Tidur</label>
                                        <select class="form-select" id="bedroomFilter">
                                            <option value="">Semua</option>
                                            <option value="1">1 Kamar</option>
                                            <option value="2">2 Kamar</option>
                                            <option value="3">3 Kamar</option>
                                            <option value="4">4 Kamar</option>
                                            <option value="5">5+ Kamar</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label for="priceRange" class="form-label">Rentang Harga</label>
                                        <select class="form-select" id="priceRange">
                                            <option value="">Semua Harga</option>
                                            <option value="0-500000000">Di bawah 500 Juta</option>
                                            <option value="500000000-750000000">500 - 750 Juta</option>
                                            <option value="750000000-1000000000">750 Juta - 1 Miliar</option>
                                            <option value="1000000000-1500000000">1 - 1.5 Miliar</option>
                                            <option value="1500000000+">Di atas 1.5 Miliar</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12 text-center">
                                        <button class="btn btn-primary me-2" id="applyFilter">
                                            <i class="fas fa-search me-1"></i>Terapkan Filter
                                        </button>
                                        <button class="btn btn-outline-secondary" id="resetFilter">
                                            <i class="fas fa-undo me-1"></i>Reset
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Asset List Section -->
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h3 id="assetListTitle">Daftar Aset Tersedia</h3>
                            <div class="badge bg-primary fs-6">
                                <span id="totalAssets">0</span> aset ditemukan
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="loadingState" class="text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">Memuat data aset...</p>
                        </div>

                        <!-- Asset Cards Container -->
                        <div id="assetContainer" class="row g-4" style="display: none;"></div>

                        <!-- No Results State -->
                        <div id="noResultsState" class="text-center py-5" style="display: none;">
                            <i class="fas fa-search fa-3x text-muted mb-3"></i>
                            <h4 class="text-muted">Tidak ada aset yang ditemukan</h4>
                            <p class="text-muted">Coba ubah filter pencarian atau cek kembali nanti</p>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Page navigation" class="mt-5">
                            <ul class="pagination justify-content-center" id="pagination"></ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Welcome Section (shown when no asset type selected) -->
            <div id="quickActionsSection">
                <div class="row justify-content-center">
                    <div class="col-md-10">
                        <div class="welcome-card">
                            <div class="text-center py-5">
                                <i class="fas fa-home fa-4x text-primary mb-4"></i>
                                <h3 class="mb-3">Selamat Datang di Sistem Properti</h3>
                                <p class="lead text-muted mb-4">
                                    Temukan properti impian Anda dengan mudah dan cepat. 
                                    Pilih jenis aset di atas untuk memulai pencarian.
                                </p>
                                <div class="features-highlight">
                                    <div class="row text-center">
                                        <div class="col-md-4">
                                            <i class="fas fa-search text-success fa-2x mb-2"></i>
                                            <h6>Pencarian Mudah</h6>
                                            <small class="text-muted">Filter berdasarkan lokasi, harga, dan spesifikasi</small>
                                        </div>
                                        <div class="col-md-4">
                                            <i class="fas fa-eye text-info fa-2x mb-2"></i>
                                            <h6>Detail Lengkap</h6>
                                            <small class="text-muted">Informasi properti yang akurat dan terpercaya</small>
                                        </div>
                                        <div class="col-md-4">
                                            <i class="fas fa-phone text-warning fa-2x mb-2"></i>
                                            <h6>Kontak Langsung</h6>
                                            <small class="text-muted">Hubungi pemilik properti dengan mudah</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<!-- Asset Detail Modal -->
<div class="modal fade" id="assetDetailModal" tabindex="-1" aria-labelledby="assetDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="assetDetailModalLabel">Detail Aset</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="assetDetailContent">
                <!-- Asset detail content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                <button type="button" class="btn btn-success" id="contactOwnerBtn">
                    <i class="fas fa-phone me-1"></i>Hubungi Pemilik
                </button>
                <button type="button" class="btn btn-primary" id="requestInfoBtn">
                    <i class="fas fa-envelope me-1"></i>Minta Info Lebih
                </button>
            </div>
        </div>
    </div>
</div>

<style>
.dashboard-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.dashboard-header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 20px 0;
    margin-bottom: 30px;
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
}

.dashboard-title {
    color: #333;
    font-weight: 700;
    margin: 0;
}

.dashboard-subtitle {
    color: #666;
    margin: 5px 0 0 0;
}

.user-info {
    display: flex;
    align-items: center;
}

.user-welcome {
    color: #333;
    font-weight: 500;
}

/* Property Cards */
.property-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.property-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.property-details {
    font-size: 0.9rem;
}

.price-section h5 {
    font-weight: 700;
}

.condition-section .badge {
    font-size: 0.75rem;
}

/* Asset Selection & Welcome Cards */
.asset-selection-card, .welcome-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}

.asset-selection-card {
    overflow: hidden;
}

.asset-selection-card .card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    text-align: center;
}

.asset-selection-card .card-header h3 {
    margin: 0 0 10px 0;
    font-size: 1.5rem;
}

.asset-selection-card .card-body {
    padding: 30px;
}

.asset-dropdown-container {
    display: flex;
    gap: 15px;
    align-items: center;
    max-width: 500px;
    margin: 0 auto;
}

.asset-select {
    flex: 1;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.asset-select:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.welcome-card {
    padding: 25px;
}

.features-highlight {
    margin-top: 2rem;
    padding: 2rem 0;
}

.features-highlight h6 {
    color: #333;
    margin-bottom: 10px;
    font-weight: 600;
}

.features-highlight .col-md-4 {
    margin-bottom: 2rem;
}

/* Responsive */
@media (max-width: 768px) {
    .asset-dropdown-container {
        flex-direction: column;
    }
    
    .features-highlight .col-md-4 {
        margin-bottom: 1.5rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // DOM elements
    const assetSelect = document.getElementById('assetTypeSelect');
    const filterSection = document.getElementById('filterSection');
    const quickActionsSection = document.getElementById('quickActionsSection');
    const assetListTitle = document.getElementById('assetListTitle');
    const bedroomContainer = document.getElementById('bedroomFilterContainer');
    
    // State variables
    let currentProperties = [];
    let currentPage = 1;
    const itemsPerPage = 12;
    let allLocations = [];
    let currentAssetType = '';

    // Initialize event listeners
    assetSelect.addEventListener('change', handleAssetTypeChange);
    document.getElementById('applyFilter').addEventListener('click', applyFilters);
    document.getElementById('resetFilter').addEventListener('click', resetFilters);
    document.addEventListener('click', handleCardActions);

    function handleAssetTypeChange() {
        if (assetSelect.value) {
            currentAssetType = assetSelect.value;
            showFilterSection();
            loadLocations();
            loadProperties();
            updateUIForAssetType();
        } else {
            hideFilterSection();
            currentAssetType = '';
        }
    }

    function updateUIForAssetType() {
        // Update title
        if (currentAssetType === 'tanah') {
            assetListTitle.textContent = 'Daftar Tanah Tersedia';
            bedroomContainer.style.display = 'none';
        } else if (currentAssetType === 'tanah_bangunan') {
            assetListTitle.textContent = 'Daftar Tanah & Bangunan Tersedia';
            bedroomContainer.style.display = 'block';
        }
    }

    function showFilterSection() {
        filterSection.style.display = 'block';
        quickActionsSection.style.display = 'none';
    }

    function hideFilterSection() {
        filterSection.style.display = 'none';
        quickActionsSection.style.display = 'block';
    }

    async function loadLocations() {
        try {
            const response = await fetch('/api/locations');
            const data = await response.json();
            allLocations = data.locations || [];
            
            const locationSelect = document.getElementById('locationFilter');
            locationSelect.innerHTML = '<option value="">Semua Kecamatan</option>';
            
            allLocations.forEach(location => {
                locationSelect.insertAdjacentHTML('beforeend', 
                    `<option value="${location.toLowerCase()}">${location}</option>`);
            });
        } catch (error) {
            console.error('Error loading locations:', error);
        }
    }

    async function loadProperties(page = 1) {
        showLoadingState();
        
        try {
            const params = buildQueryParams(page);
            const response = await fetch(`/api/properties?${params}`);
            const data = await response.json();
            
            if (data.error) throw new Error(data.error);

            currentProperties = data.properties;
            currentPage = data.page;
            
            hideLoadingState();
            displayProperties(currentProperties);
            updateTotalCount(data.total);
            generatePagination(data.total_pages, data.page);
            
        } catch (error) {
            console.error('Error loading properties:', error);
            hideLoadingState();
            showNoResults();
        }
    }

    function buildQueryParams(page) {
        const params = new URLSearchParams({
            page: page,
            per_page: itemsPerPage,
            asset_type: currentAssetType
        });

        // Add filters
        const filters = {
            condition: document.getElementById('assetConditionFilter').value,
            location: document.getElementById('locationFilter').value,
            bedrooms: document.getElementById('bedroomFilter').value,
            priceRange: document.getElementById('priceRange').value
        };

        Object.entries(filters).forEach(([key, value]) => {
            if (value) {
                if (key === 'priceRange') {
                    const [min, max] = value.split('-');
                    if (min) params.append('min_price', min);
                    if (max && max !== '+') params.append('max_price', max);
                } else {
                    params.append(key, value);
                }
            }
        });

        return params;
    }

    function displayProperties(properties) {
        const container = document.getElementById('assetContainer');
        const noResults = document.getElementById('noResultsState');

        if (properties.length === 0) {
            container.style.display = 'none';
            noResults.style.display = 'block';
            return;
        }

        noResults.style.display = 'none';
        container.style.display = 'flex';
        container.innerHTML = properties.map(property => createPropertyCardHTML(property)).join('');
    }

    function createPropertyCardHTML(property) {
        const pricePerM2 = property.land_area > 0 ? Math.round(property.price / property.land_area) : 0;
        const totalPrice = property.price;

        if (currentAssetType === 'tanah') {
            return createLandCardHTML(property, totalPrice, pricePerM2);
        } else {
            return createBuildingCardHTML(property, totalPrice, pricePerM2);
        }
    }

    function createLandCardHTML(property, totalPrice, pricePerM2) {
        return `
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 shadow-sm border-0 property-card" data-property-id="${property.id}">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <span class="badge bg-success">Jual</span>
                        <small class="text-muted"><i class="fas fa-map me-1"></i>Tanah</small>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">${property.title}</h5>
                        <p class="card-text text-muted">
                            <i class="fas fa-map-marker-alt me-1"></i>${property.location} ‚Ä¢ 
                            <i class="fas fa-certificate me-1"></i>${property.certificate ? property.certificate.substring(0, 3) : 'N/A'}
                        </p>
                        <div class="property-details">
                            <div class="row g-2 mb-3">
                                <div class="col-12">
                                    <small class="text-muted">Luas Tanah:</small><br>
                                    <strong>${property.land_area.toLocaleString()} m¬≤</strong>
                                </div>
                            </div>
                            <div class="price-section mb-3">
                                <small class="text-muted">Harga Total:</small><br>
                                <h5 class="text-success mb-1">Rp ${totalPrice.toLocaleString()}</h5>
                                <small class="text-muted">Rp ${pricePerM2.toLocaleString()}/m¬≤</small>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent">
                        <button class="btn btn-primary btn-sm me-2 view-detail-btn" data-property-id="${property.id}">
                            <i class="fas fa-eye me-1"></i>Lihat Detail
                        </button>
                        <button class="btn btn-outline-success btn-sm contact-btn">
                            <i class="fas fa-phone me-1"></i>Kontak
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    function createBuildingCardHTML(property, totalPrice, pricePerM2) {
        return `
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 shadow-sm border-0 property-card" data-property-id="${property.id}">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <span class="badge bg-success">Jual</span>
                        <small class="text-muted"><i class="fas fa-home me-1"></i>Rumah</small>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">${property.title}</h5>
                        <p class="card-text text-muted">
                            <i class="fas fa-map-marker-alt me-1"></i>${property.location} ‚Ä¢ 
                            <i class="fas fa-certificate me-1"></i>${property.certificate ? property.certificate.substring(0, 3) : 'N/A'}
                        </p>
                        <div class="property-details">
                            <div class="row g-2 mb-3">
                                <div class="col-6">
                                    <small class="text-muted">Kamar Tidur:</small><br>
                                    <strong><i class="fas fa-bed me-1"></i>${property.bedrooms || 'N/A'}</strong>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Kamar Mandi:</small><br>
                                    <strong><i class="fas fa-bath me-1"></i>${property.bathrooms || 'N/A'}</strong>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Luas Tanah:</small><br>
                                    <strong>${property.land_area.toLocaleString()} m¬≤</strong>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Luas Bangunan:</small><br>
                                    <strong>${property.building_area ? property.building_area.toLocaleString() : 'N/A'} m¬≤</strong>
                                </div>
                            </div>
                            <div class="price-section mb-3">
                                <small class="text-muted">Harga Total:</small><br>
                                <h5 class="text-success mb-1">Rp ${totalPrice.toLocaleString()}</h5>
                                <small class="text-muted">Rp ${pricePerM2.toLocaleString()}/m¬≤</small>
                            </div>
                            <div class="condition-section mb-2">
                                <span class="badge ${getConditionBadgeClass(property.condition || 'N/A')}">${property.condition || 'N/A'}</span>
                                ${property.furnished && property.furnished !== 'N/A' ? `<span class="badge bg-info ms-1">${property.furnished}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-transparent">
                        <button class="btn btn-primary btn-sm me-2 view-detail-btn" data-property-id="${property.id}">
                            <i class="fas fa-eye me-1"></i>Lihat Detail
                        </button>
                        <button class="btn btn-outline-success btn-sm contact-btn">
                            <i class="fas fa-phone me-1"></i>Kontak
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    function getConditionBadgeClass(condition) {
        const classes = {
            'baru': 'bg-success',
            'bagus': 'bg-primary',
            'sudah renovasi': 'bg-warning'
        };
        return classes[condition.toLowerCase()] || 'bg-secondary';
    }

    function generatePagination(totalPages, currentPageNum) {
        const pagination = document.getElementById('pagination');

        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }

        let html = '';
        const startPage = Math.max(1, currentPageNum - 2);
        const endPage = Math.min(totalPages, currentPageNum + 2);

        // Previous button
        html += `<li class="page-item ${currentPageNum === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${currentPageNum - 1}">Previous</a>
                 </li>`;

        // Page numbers
        if (startPage > 1) {
            html += `<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>`;
            if (startPage > 2) {
                html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            }
        }

        for (let i = startPage; i <= endPage; i++) {
            html += `<li class="page-item ${currentPageNum === i ? 'active' : ''}">
                        <a class="page-link" href="#" data-page="${i}">${i}</a>
                     </li>`;
        }

        if (endPage < totalPages) {
            if (endPage < totalPages - 1) {
                html += `<li class="page-item disabled"><span class="page-link">...</span></li>`;
            }
            html += `<li class="page-item"><a class="page-link" href="#" data-page="${totalPages}">${totalPages}</a></li>`;
        }

        // Next button
        html += `<li class="page-item ${currentPageNum === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" data-page="${currentPageNum + 1}">Next</a>
                 </li>`;

        pagination.innerHTML = html;

        // Add click handlers
        pagination.querySelectorAll('.page-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = parseInt(this.dataset.page);
                if (page && page !== currentPageNum && page >= 1 && page <= totalPages) {
                    loadProperties(page);
                }
            });
        });
    }

    function showLoadingState() {
        document.getElementById('loadingState').style.display = 'block';
        document.getElementById('assetContainer').style.display = 'none';
        document.getElementById('noResultsState').style.display = 'none';
    }

    function hideLoadingState() {
        document.getElementById('loadingState').style.display = 'none';
    }

    function showNoResults() {
        document.getElementById('assetContainer').style.display = 'none';
        document.getElementById('noResultsState').style.display = 'block';
    }

    function updateTotalCount(count) {
        document.getElementById('totalAssets').textContent = count;
    }

    function applyFilters() {
        currentPage = 1;
        loadProperties(1);
    }

    function resetFilters() {
        const filterIds = ['assetConditionFilter', 'locationFilter', 'bedroomFilter', 'priceRange'];
        filterIds.forEach(id => document.getElementById(id).value = '');
        currentPage = 1;
        loadProperties(1);
    }

    // Handle card actions (view detail and contact)
    async function handleCardActions(e) {
        if (e.target.classList.contains('view-detail-btn') || e.target.closest('.view-detail-btn')) {
            const btn = e.target.classList.contains('view-detail-btn') ? e.target : e.target.closest('.view-detail-btn');
            const propertyId = parseInt(btn.dataset.propertyId);
            await showPropertyDetail(propertyId);
        }

        if (e.target.classList.contains('contact-btn') || e.target.closest('.contact-btn')) {
            alert('Untuk informasi lebih lanjut, hubungi: +62 21 1234 5678');
        }
    }

    async function showPropertyDetail(propertyId) {
        try {
            const response = await fetch(`/api/property/${propertyId}`);
            const property = await response.json();
            
            if (property.error) {
                alert('Property not found');
                return;
            }

            const modal = new bootstrap.Modal(document.getElementById('assetDetailModal'));
            const content = document.getElementById('assetDetailContent');
            const pricePerM2 = property.land_area > 0 ? Math.round(property.price / property.land_area) : 0;

            content.innerHTML = currentAssetType === 'tanah' ? 
                createLandDetailHTML(property, pricePerM2) : 
                createBuildingDetailHTML(property, pricePerM2);

            modal.show();
        } catch (error) {
            console.error('Error loading property detail:', error);
            alert('Error loading property details');
        }
    }

    function createLandDetailHTML(property, pricePerM2) {
        return `
            <div class="row">
                <div class="col-md-8">
                    <h4>${property.title}</h4>
                    <p class="text-muted mb-3">
                        <i class="fas fa-map-marker-alt me-2"></i>${property.location}
                    </p>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-expand-arrows-alt text-primary"></i>
                                <strong class="ms-2">Luas Tanah</strong><br>
                                <span class="ms-4">${property.land_area.toLocaleString()} m¬≤</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-certificate text-primary"></i>
                                <strong class="ms-2">Sertifikat</strong><br>
                                <span class="ms-4">${property.certificate || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h5 class="text-primary">Harga Total</h5>
                            <h3 class="text-success">Rp ${property.price.toLocaleString()}</h3>
                            <hr>
                            <h6>Harga per m¬≤</h6>
                            <h4 class="text-dark">Rp ${pricePerM2.toLocaleString()}</h4>
                            <small class="text-muted">*Harga dapat berubah sewaktu-waktu</small>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function createBuildingDetailHTML(property, pricePerM2) {
        return `
            <div class="row">
                <div class="col-md-8">
                    <h4>${property.title}</h4>
                    <p class="text-muted mb-3">
                        <i class="fas fa-map-marker-alt me-2"></i>${property.location}
                    </p>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-bed text-primary"></i>
                                <strong class="ms-2">Kamar Tidur</strong><br>
                                <span class="ms-4">${property.bedrooms || 'N/A'} Kamar</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-bath text-primary"></i>
                                <strong class="ms-2">Kamar Mandi</strong><br>
                                <span class="ms-4">${property.bathrooms || 'N/A'} Kamar</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-expand-arrows-alt text-primary"></i>
                                <strong class="ms-2">Luas Tanah</strong><br>
                                <span class="ms-4">${property.land_area.toLocaleString()} m¬≤</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-home text-primary"></i>
                                <strong class="ms-2">Luas Bangunan</strong><br>
                                <span class="ms-4">${property.building_area ? property.building_area.toLocaleString() : 'N/A'} m¬≤</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-certificate text-primary"></i>
                                <strong class="ms-2">Sertifikat</strong><br>
                                <span class="ms-4">${property.certificate || 'N/A'}</span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="border rounded p-3">
                                <i class="fas fa-bolt text-primary"></i>
                                <strong class="ms-2">Daya Listrik</strong><br>
                                <span class="ms-4">${property.power > 0 ? property.power + ' Watt' : 'N/A'}</span>
                            </div>
                        </div>
                    </div>

                    <h5>Detail Tambahan</h5>
                    <div class="row g-2 mb-3">
                        <div class="col-sm-6">
                            <small class="text-muted">Jumlah Lantai:</small>
                            <div>${property.floors || 'N/A'} Lantai</div>
                        </div>
                        <div class="col-sm-6">
                            <small class="text-muted">Kondisi:</small>
                            <div><span class="badge ${getConditionBadgeClass(property.condition || 'N/A')}">${property.condition || 'N/A'}</span></div>
                        </div>
                        <div class="col-sm-6">
                            <small class="text-muted">Hadap:</small>
                            <div>${property.facing || 'N/A'}</div>
                        </div>
                        <div class="col-sm-6">
                            <small class="text-muted">Sumber Air:</small>
                            <div>${property.water_source || 'N/A'}</div>
                        </div>
                        <div class="col-sm-6">
                            <small class="text-muted">Internet:</small>
                            <div>${property.internet === 'Ya' ? '‚úÖ Tersedia' : '‚ùå Tidak Tersedia'}</div>
                        </div>
                        <div class="col-sm-6">
                            <small class="text-muted">Hook:</small>
                            <div>${property.hook === 'Ya' ? '‚úÖ Hook' : '‚ùå Tidak Hook'}</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card bg-light">
                        <div class="card-body text-center">
                            <h5 class="text-primary">Harga Total</h5>
                            <h3 class="text-success">Rp ${property.price.toLocaleString()}</h3>
                            <hr>
                            <h6>Harga per m¬≤</h6>
                            <h4 class="text-dark">Rp ${pricePerM2.toLocaleString()}</h4>
                            <small class="text-muted">*Harga dapat berubah sewaktu-waktu</small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0">Fasilitas</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-2">
                                    <i class="fas fa-utensils me-2"></i>
                                    <span>Ruang Makan: ${property.dining_room || 'N/A'}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-couch me-2"></i>
                                    <span>Ruang Tamu: ${property.living_room || 'N/A'}</span>
                                </div>
                                <div class="mb-2">
                                    <i class="fas fa-car me-2"></i>
                                    <span>Lebar Jalan: ${property.road_width || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }
});
</script>
{% endblock %}
