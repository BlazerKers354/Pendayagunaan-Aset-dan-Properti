<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/dashAdmin.css') }}"
    />
    <title>Dashboard Admin | Telkom Aset</title>
  </head>
  <body>
    <div class="container">
      <!-- SIDEBAR -->
      <aside>
        <div class="toggle">
          <div class="logo">
            <img
              src="{{ url_for('static', filename='img/telkomLogo.png') }}"
              style="border-radius: 20px"
            />
            <h2>Telkom<span class="danger">Aset</span></h2>
          </div>
          <div class="close" id="close-btn">
            <span class="material-icons-sharp">close</span>
          </div>
        </div>

        <div class="sidebar">
          <a href="#" class="menu-link active" data-target="dashboard-home">
            <span class="material-icons-sharp">dashboard</span>
            <h3>Dashboard</h3>
          </a>
          <a href="#" class="menu-link" data-target="visualisasi">
            <span class="material-icons-sharp">insights</span>
            <h3>Visualisasi Data</h3>
          </a>
          <a href="#" class="menu-link" data-target="prediksi">
            <span class="material-icons-sharp">show_chart</span>
            <h3>Prediksi</h3>
          </a>
          <a href="#" class="menu-link" data-target="total-properti">
            <span class="material-icons-sharp">home_work</span>
            <h3>Total Properti</h3>
          </a>
          <a href="#" class="menu-link" data-target="aset-sewa">
            <span class="material-icons-sharp">apartment</span>
            <h3>Aset Disewa</h3>
          </a>
          <a href="#" class="menu-link" data-target="aset-jual">
            <span class="material-icons-sharp">sell</span>
            <h3>Aset Dijual</h3>
          </a>
          <a href="#" class="menu-link" data-target="manajemen-aset">
            <span class="material-icons-sharp">manage_accounts</span>
            <h3>Manajemen Data Aset</h3>
          </a>
          <a href="#" class="menu-link" data-target="notifikasi">
            <span class="material-icons-sharp">notifications</span>
            <h3>Notifikasi</h3>
          </a>
          <a href="{{ url_for('main.logout') }}">
            <span class="material-icons-sharp">logout</span>
            <h3>Logout</h3>
          </a>
        </div>
      </aside>

      <!-- MAIN CONTENT -->
      <main>
        <!-- Dashboard Utama -->
        <section id="dashboard-home" class="content-section active">
          <h1>Dashboard Utama</h1>
          <div class="analyse">
            <div class="sales">
              <div class="status">
                <div class="info">
                  <h3>Total Properties</h3>
                  <h1>{{ stats.total_properties or 0 }}</h1>
                </div>
                <div class="progresss">
                  <svg>
                    <circle cx="38" cy="38" r="36"></circle>
                  </svg>
                  <div class="percentage">
                    <p>+81%</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="visits">
              <div class="status">
                <div class="info">
                  <h3>Average Price</h3>
                  <h1>Rp {{ "{:,.0f}".format(stats.avg_price or 0) }}</h1>
                </div>
                <div class="progresss">
                  <svg>
                    <circle cx="38" cy="38" r="36"></circle>
                  </svg>
                  <div class="percentage">
                    <p>-48%</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="searches">
              <div class="status">
                <div class="info">
                  <h3>Total Locations</h3>
                  <h1>{{ stats.total_locations or 0 }}</h1>
                </div>
                <div class="progresss">
                  <svg>
                    <circle cx="38" cy="38" r="36"></circle>
                  </svg>
                  <div class="percentage">
                    <p>+21%</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Visualisasi -->
        <section id="visualisasi" class="content-section">
          <h1>Visualisasi Data</h1>
        </section>

        <!-- Prediksi -->
        <section id="prediksi" class="content-section">
          <h1>Prediksi Harga Properti</h1>
          <div class="prediksi-container">
            <div class="prediksi-card">
              <div class="prediksi-header">
                <h2><span class="material-icons-sharp">psychology</span> Machine Learning Prediction</h2>
                <p>Gunakan algoritma Machine Learning untuk memprediksi harga properti</p>
              </div>
              
              <div class="models-info">
                <div class="model-item">
                  <span class="material-icons-sharp">smart_toy</span>
                  <h3>Random Forest</h3>
                  <p>Ensemble learning dengan multiple decision trees</p>
                </div>
                
                <div class="model-item">
                  <span class="material-icons-sharp">auto_awesome</span>
                  <h3>XGBoost</h3>
                  <p>Gradient boosting framework yang powerful</p>
                </div>
                
                <div class="model-item">
                  <span class="material-icons-sharp">speed</span>
                  <h3>CatBoost</h3>
                  <p>Handling categorical features dengan optimal</p>
                </div>
              </div>
              
              <div class="prediksi-actions">
                <button class="btn-primary" onclick="openPredictionPage()">
                  <span class="material-icons-sharp">launch</span>
                  Buka Halaman Prediksi
                </button>
                
                <button class="btn-secondary" onclick="trainModels()">
                  <span class="material-icons-sharp">build</span>
                  Train Models
                </button>
              </div>
              
              <div class="model-status" id="modelStatus">
                <h3>Status Model</h3>
                <div class="status-loading">
                  <span class="material-icons-sharp">refresh</span>
                  Loading status...
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Total Properti -->
        <section id="total-properti" class="content-section">
          <h1>Total Properti</h1>
        </section>

        <!-- Aset Disewa -->
        <section id="aset-sewa" class="content-section">
          <h1>Aset Tersedia untuk Disewa</h1>
        </section>

        <!-- Aset Dijual -->
        <section id="aset-jual" class="content-section">
          <h1>Aset Tersedia untuk Dijual</h1>
        </section>

        <!-- Manajemen Aset -->
        <section id="manajemen-aset" class="content-section">
          <h1>Manajemen Data Aset</h1>
          
          <div class="crud-container">
            <!-- Add Property Button -->
            <div class="crud-header">
              <button class="btn-primary" onclick="openAddPropertyModal()">
                <span class="material-icons-sharp">add</span>
                Tambah Properti Baru
              </button>
              
              <div class="filter-section">
                <select id="filterPropertyType" onchange="filterProperties()">
                  <option value="">Semua Jenis</option>
                  <option value="tanah">Tanah</option>
                  <option value="tanah_bangunan">Tanah + Bangunan</option>
                </select>
                
                <select id="filterStatus" onchange="filterProperties()">
                  <option value="">Semua Status</option>
                  <option value="aktif">Aktif</option>
                  <option value="tidak_aktif">Tidak Aktif</option>
                </select>
              </div>
            </div>
            
            <!-- Properties Table -->
            <div class="table-container">
              <table id="propertiesTable">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Judul</th>
                    <th>Lokasi</th>
                    <th>Jenis</th>
                    <th>Harga</th>
                    <th>Luas Tanah</th>
                    <th>Status</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody id="propertiesTableBody">
                  <!-- Properties will be loaded here -->
                </tbody>
              </table>
              
              <div id="loadingProperties" class="loading-state">
                <span class="material-icons-sharp">refresh</span>
                Loading properties...
              </div>
              
              <div id="noProperties" class="no-data" style="display: none;">
                <span class="material-icons-sharp">home_work</span>
                <p>Belum ada properti yang ditambahkan</p>
              </div>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container">
              <div class="pagination" id="propertiesPagination">
                <!-- Pagination will be generated here -->
              </div>
            </div>
          </div>
        </section>

        <!-- Notifikasi -->
        <section id="notifikasi" class="content-section">
          <h1>Notifikasi</h1>
        </section>
      </main>

      <!-- RIGHT SECTION -->
      <div class="right-section">
        <div class="nav">
          <button id="menu-btn">
            <span class="material-icons-sharp">menu</span>
          </button>
          <div class="dark-mode">
            <span class="material-icons-sharp active">light_mode</span>
            <span class="material-icons-sharp">dark_mode</span>
          </div>
          <div class="profile">
            <div class="info">
              <p>Hey, <b>{{ session.user_name or 'Admin' }}</b></p>
              <small class="text-muted">Admin</small>
            </div>
            <div class="profile-photo">
              <img src="{{ url_for('static', filename='img/profile.jpg') }}" />
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Add/Edit Property Modal -->
    <div id="propertyModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modalTitle">Tambah Properti Baru</h2>
          <span class="close" onclick="closePropertyModal()">&times;</span>
        </div>
        
        <form id="propertyForm" class="property-form">
          <input type="hidden" id="propertyId" name="property_id">
          
          <div class="form-row">
            <div class="form-group">
              <label for="title">Judul Properti *</label>
              <input type="text" id="title" name="title" required>
            </div>
            
            <div class="form-group">
              <label for="property_type">Jenis Properti *</label>
              <select id="property_type" name="property_type" required onchange="toggleBuildingFields()">
                <option value="">Pilih Jenis</option>
                <option value="tanah">Tanah</option>
                <option value="tanah_bangunan">Tanah + Bangunan</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="location">Lokasi *</label>
              <input type="text" id="location" name="location" required>
            </div>
            
            <div class="form-group">
              <label for="price">Harga (Rp) *</label>
              <input type="number" id="price" name="price" required min="0">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="land_area">Luas Tanah (m²) *</label>
              <input type="number" id="land_area" name="land_area" required min="0" step="0.01">
            </div>
            
            <div class="form-group building-field">
              <label for="building_area">Luas Bangunan (m²)</label>
              <input type="number" id="building_area" name="building_area" min="0" step="0.01">
            </div>
          </div>
          
          <div class="form-row building-fields">
            <div class="form-group">
              <label for="bedrooms">Kamar Tidur</label>
              <input type="number" id="bedrooms" name="bedrooms" min="0">
            </div>
            
            <div class="form-group">
              <label for="bathrooms">Kamar Mandi</label>
              <input type="number" id="bathrooms" name="bathrooms" min="0">
            </div>
            
            <div class="form-group">
              <label for="floors">Jumlah Lantai</label>
              <input type="number" id="floors" name="floors" min="1" value="1">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="certificate">Sertifikat</label>
              <select id="certificate" name="certificate">
                <option value="">Pilih Sertifikat</option>
                <option value="SHM">SHM (Sertifikat Hak Milik)</option>
                <option value="SHGB">SHGB (Sertifikat Hak Guna Bangunan)</option>
                <option value="SHGU">SHGU (Sertifikat Hak Guna Usaha)</option>
                <option value="Girik">Girik</option>
                <option value="AJB">AJB (Akta Jual Beli)</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="condition_property">Kondisi Properti</label>
              <select id="condition_property" name="condition_property">
                <option value="">Pilih Kondisi</option>
                <option value="baru">Baru</option>
                <option value="bagus">Bagus</option>
                <option value="sudah renovasi">Sudah Renovasi</option>
                <option value="butuh renovasi">Butuh Renovasi</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="facing">Hadap</label>
              <select id="facing" name="facing">
                <option value="">Pilih Arah</option>
                <option value="utara">Utara</option>
                <option value="selatan">Selatan</option>
                <option value="timur">Timur</option>
                <option value="barat">Barat</option>
                <option value="timur laut">Timur Laut</option>
                <option value="tenggara">Tenggara</option>
                <option value="barat daya">Barat Daya</option>
                <option value="barat laut">Barat Laut</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="water_source">Sumber Air</label>
              <input type="text" id="water_source" name="water_source" placeholder="PDAM, Sumur, dll">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="internet">Internet</label>
              <select id="internet" name="internet">
                <option value="Tidak">Tidak</option>
                <option value="Ya">Ya</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="hook">Hook</label>
              <select id="hook" name="hook">
                <option value="Tidak">Tidak</option>
                <option value="Ya">Ya</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="power">Daya Listrik (Watt)</label>
              <input type="number" id="power" name="power" min="0">
            </div>
          </div>
          
          <div class="form-row building-fields">
            <div class="form-group">
              <label for="dining_room">Ruang Makan</label>
              <input type="text" id="dining_room" name="dining_room">
            </div>
            
            <div class="form-group">
              <label for="living_room">Ruang Tamu</label>
              <input type="text" id="living_room" name="living_room">
            </div>
            
            <div class="form-group">
              <label for="furnished">Furnished</label>
              <select id="furnished" name="furnished">
                <option value="">Pilih</option>
                <option value="Furnished">Furnished</option>
                <option value="Semi Furnished">Semi Furnished</option>
                <option value="Unfurnished">Unfurnished</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="road_width">Lebar Jalan</label>
              <input type="text" id="road_width" name="road_width" placeholder="contoh: 6 meter">
            </div>
            
            <div class="form-group">
              <label for="status">Status</label>
              <select id="status" name="status">
                <option value="aktif">Aktif</option>
                <option value="tidak_aktif">Tidak Aktif</option>
              </select>
            </div>
          </div>
          
          <div class="form-group full-width">
            <label for="description">Deskripsi</label>
            <textarea id="description" name="description" rows="4" placeholder="Deskripsi detail properti..."></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" onclick="closePropertyModal()" class="btn-secondary">Batal</button>
            <button type="submit" class="btn-primary">
              <span class="material-icons-sharp">save</span>
              Simpan
            </button>
          </div>
        </form>
      </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/dashAdmin.js') }}"></script>
  </body>
</html>